<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <title>숫자기억 · 60초</title>
  <meta name="theme-color" content="#0b0e12">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="apple-mobile-web-app-title" content="숫자기억">
  <link rel="manifest" href="manifest.webmanifest">
  <link rel="icon" href="icons/icon-192-v5.png">
  <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon-180-v5.png">
  <link rel="apple-touch-icon" sizes="167x167" href="icons/apple-touch-icon-167-v5.png">
  <link rel="apple-touch-icon" sizes="152x152" href="icons/apple-touch-icon-152-v5.png">
  <link rel="apple-touch-icon" sizes="120x120" href="icons/apple-touch-icon-120-v5.png">
  <link rel="apple-touch-icon" href="apple-touch-icon.png">
  <style>
    :root {
      --bg: #0b0e12;
      --card: #131823;
      --text: #e8eefc;
      --accent: #5aa7ff;
      --muted: #9fb3d1;
      --good: #29cc76;
      --bad: #ff5555;
      --warn: #ffc857;
      --active: #2ee58a;
      --darkText: #0b0e12;
    }
    * { box-sizing: border-box; }
    html, body {
      height: 100%;
      margin: 0;
      background: var(--bg);
      color: var(--text);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Noto Sans KR, Apple SD Gothic Neo, sans-serif;
    }
    .wrap {
      max-width: 520px;
      margin: 0 auto;
      min-height: 100%;
      display: flex;
      flex-direction: column;
      padding: 16px;
      gap: 16px;
    }
    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
    }
    .badge {
      padding: 6px 10px;
      border-radius: 999px;
      background: #0f1420;
      color: var(--muted);
      font-size: 12px;
      letter-spacing: .3px;
    }
    .card {
      background: linear-gradient(180deg, #131823 0%, #0e1320 100%);
      border: 1px solid rgba(255,255,255,.06);
      border-radius: 16px;
      padding: 16px;
      box-shadow: 0 6px 20px rgba(0,0,0,.25);
    }
    .hud {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 10px;
      text-align: center;
    }
    .hud .item {
      background: #0f1522;
      border: 1px solid rgba(255,255,255,.06);
      border-radius: 12px;
      padding: 10px;
    }
    .label {
      font-size: 12px;
      color: var(--muted);
      margin-bottom: 6px;
    }
    .value {
      font-size: 20px;
      font-weight: 700;
      letter-spacing: .5px;
    }
    .stage {
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 44vh;
      text-align: center;
      border-radius: 16px;
      border: 1px dashed rgba(255,255,255,.1);
      background: radial-gradient(1200px 600px at 50% -10%, rgba(90,167,255,.15), transparent 40%);
      padding: 12px;
      position: relative;
    }
    .number {
      font-size: clamp(32px, 7.5vw, 72px);
      letter-spacing: .05em;
      font-weight: 800;
      text-shadow: 0 4px 20px rgba(90,167,255,.25);
      user-select: none;
    }
    .status {
      position: absolute;
      top: 10px; right: 12px;
      font-size: 12px;
      color: var(--muted);
      opacity: .9;
    }
    .controls {
      display: grid;
      grid-template-columns: 1fr;
      gap: 12px;
    }
    button, input {
      width: 100%;
      font-size: 18px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.08);
      padding: 14px 16px;
      background: #0f1522;
      color: var(--text);
      outline: none;
    }
    button {
      background: linear-gradient(180deg, #182238 0%, #121a2c 100%);
      cursor: pointer;
      font-weight: 700;
      letter-spacing: .3px;
      transition: transform .05s ease, box-shadow .2s ease, filter .2s ease, background .2s ease;
    }
    button:active { transform: translateY(1px); }
    button.primary { background: linear-gradient(180deg, #2e6de1 0%, #2352a8 100%); }
    button.warn { background: linear-gradient(180deg, #ef9d2f 0%, #c17c22 100%); }
    button.good:not(:disabled) {
      background: linear-gradient(180deg, var(--active) 0%, #17b86c 100%);
      box-shadow: 0 0 0 3px rgba(46,229,138,.25), 0 8px 22px rgba(23,184,108,.35);
      border-color: rgba(46,229,138,.6);
      color: var(--darkText);
      text-shadow: none;
      font-weight: 900;
    }
    button:disabled {
      opacity: .45;
      filter: grayscale(25%);
      cursor: not-allowed;
    }
    .hint {
      font-size: 13px;
      color: var(--muted);
      text-align: center;
    }
    .result {
      text-align: center;
      padding: 8px;
      font-size: 16px;
    }
    .good { color: var(--good); }
    .bad { color: var(--bad); }
    .sr-only {
      position: absolute;
      width: 1px; height: 1px;
      padding: 0; margin: -1px;
      overflow: hidden; clip: rect(0,0,0,0);
      white-space: nowrap; border: 0;
    }
    .row { display: flex; gap: 10px; }
    .row > * { flex: 1; }
    footer { text-align: center; color: var(--muted); font-size: 12px; padding-bottom: 8px; }
    a { color: var(--accent); text-decoration: none; }
    .install-tip {
      text-align:center;
      font-size:12px;
      color:var(--muted);
      margin-top:4px;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="badge">숫자기억 · 60초</div>
      <div class="badge" id="msg">준비 완료</div>
    </header>

    <div class="card hud" role="region" aria-label="게임 정보">
      <div class="item"><div class="label">남은 시간</div><div class="value" id="time">60</div></div>
      <div class="item"><div class="label">점수</div><div class="value" id="score">0</div></div>
      <div class="item"><div class="label">연속</div><div class="value" id="combo">0</div></div>
      <div class="item"><div class="label">최고</div><div class="value" id="best">0</div></div>
    </div>

    <div class="card stage" role="region" aria-live="polite" aria-atomic="true">
      <div class="status" id="level">난이도: 3자리</div>
      <div class="number" id="display">시작 버튼을 누르세요</div>
    </div>

    <div class="controls card">
      <div class="row">
        <button id="startBtn" class="primary" aria-label="게임 시작">게임 시작</button>
        <button id="giveupBtn" class="warn" aria-label="그만하기" disabled>그만하기</button>
      </div>
      <div class="row">
        <input id="answer" type="tel" inputmode="numeric" pattern="[0-9]*" placeholder="숫자를 입력하세요" aria-label="정답 입력" disabled />
        <button id="checkBtn" class="good" aria-label="정답 확인" disabled>확인</button>
      </div>
      <div class="hint">키보드 <strong>Enter</strong>로 확인 / <strong>Esc</strong>로 그만하기</div>
      <div class="install-tip" id="installTip" hidden>홈 화면에 추가하려면 브라우저 메뉴에서 <strong>“홈 화면에 추가”</strong>를 선택하세요.</div>
      <div id="result" class="result" aria-live="polite"></div>
    </div>

    <footer>© 숫자기억 · 오프라인 지원(PWA) · 데이터를 수집하지 않습니다.</footer>
  </div>

  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('./sw.js').catch(console.error);
      });
    }

    const ua = navigator.userAgent.toLowerCase();
    const isMobile = /iphone|ipad|android/.test(ua);
    if (isMobile) {
      document.getElementById('installTip').hidden = false;
    }

    (() => {
      const $ = (id) => document.getElementById(id);
      const display = $("display");
      const timeEl = $("time");
      const scoreEl = $("score");
      const comboEl = $("combo");
      const bestEl = $("best");
      const levelEl = $("level");
      const msgEl = $("msg");
      const startBtn = $("startBtn");
      const giveupBtn = $("giveupBtn");
      const answer = $("answer");
      const checkBtn = $("checkBtn");
      const result = $("result");

      let timer = null;
      let timeLeft = 60;
      let score = 0;
      let combo = 0;
      let best = parseInt(localStorage.getItem("nm_best") || "0", 10);
      bestEl.textContent = best;
      let running = false;
      let current = "";
      let length = 3;
      let showing = false;

      function setMsg(text) { msgEl.textContent = text; }
      function setLevel() { levelEl.textContent = `난이도: ${length}자리`; }

      function randDigit() { return Math.floor(Math.random() * 10).toString(); }
      function makeSequence(n) {
        let s = "";
        for (let i = 0; i < n; i++) s += randDigit();
        return s;
      }

      function sleep(ms) { return new Promise(res => setTimeout(res, ms)); }

      async function showSequence(seq) {
        showing = true;
        display.textContent = "";
        for (const ch of seq) {
          display.textContent = ch;
          await sleep(800);
          display.textContent = "";
          await sleep(250);
        }
        display.textContent = seq;
        await sleep(Math.min(700 + seq.length * 80, 1600));
        display.textContent = "입력하세요";
        showing = false;
      }

      function resetState() {
        running = false;
        timeLeft = 60;
        score = 0;
        combo = 0;
        length = 3;
        current = "";
        clearInterval(timer);
        timeEl.textContent = "60";
        scoreEl.textContent = "0";
        comboEl.textContent = "0";
        setLevel();
        display.textContent = "시작 버튼을 누르세요";
        result.textContent = "";
        answer.value = "";
        startBtn.disabled = false;
        giveupBtn.disabled = true;
        answer.disabled = true;
        checkBtn.disabled = true;
        setMsg("준비 완료");
      }

      function tick() {
        timeLeft -= 1;
        timeEl.textContent = timeLeft.toString();
        if (timeLeft <= 0) {
          finishGame();
        }
      }

      async function nextRound() {
        answer.disabled = true;
        checkBtn.disabled = true;
        answer.value = "";
        current = makeSequence(length);
        await showSequence(current);
        answer.disabled = false;
        checkBtn.disabled = false;
        answer.focus();
      }

      function startGame() {
        if (running) return;
        running = true;
        setMsg("진행 중");
        startBtn.disabled = true;
        giveupBtn.disabled = false;
        answer.disabled = true;
        checkBtn.disabled = true;
        result.textContent = "";
        timeLeft = 60; timeEl.textContent = "60";
        score = 0; scoreEl.textContent = "0";
        combo = 0; comboEl.textContent = "0";
        length = 3; setLevel();
        timer = setInterval(tick, 1000);
        nextRound();
      }

      function finishGame() {
        clearInterval(timer);
        running = false;
        startBtn.disabled = false;
        giveupBtn.disabled = true;
        answer.disabled = true;
        checkBtn.disabled = true;
        display.textContent = "게임 종료";
        setMsg("끝!");
        if (score > best) {
          best = score;
          localStorage.setItem("nm_best", String(best));
          bestEl.textContent = String(best);
          result.innerHTML = `<span class="good">최고 기록 갱신!</span> 점수 <strong>${score}</strong>`;
        } else {
          result.innerHTML = `점수 <strong>${score}</strong> / 최고 <strong>${best}</strong>`;
        }
      }

      function giveUp() {
        if (!running) return;
        timeLeft = 0;
        tick();
      }

      function checkAnswer() {
        if (!running || showing) return;
        const val = answer.value.trim();
        if (!val) return;
        if (val === current) {
          const bonus = 10 + Math.max(0, length - 3) * 2;
          combo += 1;
          score += bonus + Math.floor(combo / 3) * 2;
          scoreEl.textContent = String(score);
          comboEl.textContent = String(combo);
          result.innerHTML = `<span class="good">정답!</span> +${bonus}${combo >= 3 ? ` (콤보 보너스)` : ""}`;
          if (combo % 2 === 0) {
            length = Math.min(length + 1, 12);
            setLevel();
          }
        } else {
          result.innerHTML = `<span class="bad">오답!</span> 정답은 <strong>${current}</strong>`;
          combo = 0; comboEl.textContent = "0";
          length = Math.max(3, length - 1);
          setLevel();
        }
        nextRound();
      }

      startBtn.addEventListener("click", startGame);
      giveupBtn.addEventListener("click", giveUp);
      checkBtn.addEventListener("click", checkAnswer);
      answer.addEventListener("keydown", (e) => {
        if (e.key === "Enter") { e.preventDefault(); checkAnswer(); }
      });
      window.addEventListener("keydown", (e) => {
        if (e.key === "Escape") giveUp();
      });

      document.addEventListener("gesturestart", (e) => e.preventDefault());
      resetState();
    })();
  </script>
</body>
</html>
